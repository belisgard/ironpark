# Техническое задание: HTML-прототип B2P (Партнёр + Механик)

## 1. Общая информация

**Название проекта:** HTML-прототип B2P-платформы

**Версия документа:** 2.0

**Дата создания:** 2024

**Автор:** Кузнецов Игорь

---

## 2. Цель проекта

Сгенерировать статический интерактивный прототип (HTML/CSS/JS) для B2P-платформы:
1. **Web-кабинет партнёра** — управление автопарком, водителями, штрафами, ремонтами
2. **Mobile-интерфейс механика** — выдача и приёмка автомобилей, осмотры

**Назначение прототипа:**
- Согласование структуры экранов
- Согласование навигации
- Согласование бизнес-состояний
- Демонстрация UI-поведения

**Особенности:**
- Данные — моковые (заглушки)
- Логика — в виде UI-состояний и простых JS-переключателей
- Без backend, без API

---

## 3. Технологии и ограничения

### 3.1. Технологический стек
- **HTML5** — разметка
- **CSS3** — стилизация (без препроцессоров)
- **Vanilla JavaScript** — интерактивность (без фреймворков)
- **Без сборщиков** — проект открывается двойным кликом на `index.html`

### 3.2. Технические ограничения

**Вариант А: Vanilla JS (рекомендуется для прототипа)**
- ❌ Без фреймворков (React, Vue, Angular и т.д.)
- ❌ Без сборщиков (Webpack, Vite, Parcel и т.д.)
- ❌ Без препроцессоров (SASS, LESS и т.д.)
- ✅ Gravity UI используется как **референс дизайна** (цвета, стили, компоненты)
- ✅ Компоненты реализуются на нативном HTML/CSS/JS
- ✅ Проект открывается двойным кликом на `index.html`

**Вариант Б: React + Gravity UI (если требуется использовать готовые компоненты)**
- ✅ React (через CDN или сборщик)
- ✅ Gravity UI UIKit (`@gravity-ui/uikit`)
- ⚠️ Потребуется сборщик или использование React через CDN
- ⚠️ Усложняет развёртывание (нужен npm install)

**Выбранный вариант:** Вариант А (Vanilla JS с референсом Gravity UI)

### 3.3. Навигация
- Все страницы связаны ссылками
- Можно использовать hash-router (`location.hash`) или отдельные HTML-файлы
- Рекомендуется: отдельные HTML-файлы для простоты

### 3.4. Адаптивность
- **Web:** >= 1024px (кабинет партнёра)
- **Mobile:** <= 480px (интерфейс механика)
- Использовать media queries

### 3.5. Дизайн-система: Gravity UI

**Источник:** [Gravity UI UIKit](https://github.com/gravity-ui/uikit)

**Подход:** Использование Gravity UI как референса для:
- Цветовой палитры (light/dark темы)
- Типографики
- Стилей компонентов (кнопки, таблицы, бейджи, формы)
- Принципов композиции и spacing

**Реализация:**
- Компоненты реализуются на vanilla HTML/CSS/JS
- Стили адаптируются из дизайн-системы Gravity UI
- Используются принципы и паттерны из документации

**Основные компоненты для адаптации:**
- Button (кнопки с разными view: action, normal, etc.)
- Badge (бейджи статусов)
- Table (таблицы с hover и сортировкой)
- Input, Select, Checkbox (формы)
- Card (карточки метрик)
- Modal (модальные окна)
- Tabs (вкладки)
- Alert (уведомления и алерты)

**Темы:**
- Поддержка light и dark тем (через CSS переменные)
- Адаптация цветовой палитры из Gravity UI

**Шрифт:**
- Использовать системный шрифт (`system-ui`) или шрифты из Gravity UI (если доступны через CDN)

### 3.6. Референсы и ресурсы Gravity UI

**Документация:**
- [Официальный сайт](https://gravity-ui.com)
- [GitHub репозиторий](https://github.com/gravity-ui/uikit)
- [Storybook](https://preview.gravity-ui.com) — примеры компонентов
- [Figma](https://www.figma.com/@gravity-ui) — дизайн-макеты

**Что использовать:**
- Цветовая палитра (CSS переменные)
- Размеры и spacing
- Типографика (размеры шрифтов, line-height)
- Стили компонентов (border-radius, shadows, transitions)
- Иконки (если доступны через CDN или SVG)

**Что НЕ использовать напрямую:**
- React-компоненты (реализуем на vanilla JS)
- NPM пакет `@gravity-ui/uikit` (используем только как референс)

---

## 4. Структура проекта

```
/
  index.html                (лендинг-выбор роли)
  partner/
    dashboard.html
    cars.html
    car.html                (карточка ТС)
    drivers.html
    driver.html             (карточка водителя)
    fines.html
    fine.html               (карточка штрафа)
    service-orders.html     (заказ-наряды/ремонты)
    reports.html
    users.html              (управление пользователями)
  mechanic/
    home.html               (список задач)
    issue.html              (выдача авто)
    return.html             (приёмка авто)
    inspections.html        (история осмотров)
  assets/
    css/
      styles.css            (основные стили)
      gravity-theme.css     (CSS переменные из Gravity UI)
    js/
      app.js                (общие хелперы)
      mock-data.js          (моковые сущности)
      ui-state.js           (переключение состояний)
    img/
      placeholder.png       (заглушка изображения)
```

---

## 5. Общие UI-компоненты

**Примечание:** Все компоненты должны соответствовать стилю и принципам дизайн-системы Gravity UI (адаптированы для vanilla JS).

### 5.1. Верхняя панель (Header)
- Заголовок/логотип
- Поиск-заглушка (визуально, без функционала)
- Профиль-заглушка (иконка/аватар)

### 5.2. Левое меню (для партнёра)
- Dashboard
- Авто
- Водители
- Штрафы
- Ремонты
- Пользователи
- Отчёты

### 5.3. Таблица (реестр)
- Строки с hover-эффектом
- Сортировка заглушкой (визуальная индикация)
- Кликабельные строки (переход на детальную карточку)

### 5.4. Бейджи статусов (Badge)
Стиль по Gravity UI: скругленные углы, цветовая индикация, размеры (s, m, l)

- **ТС:** 
  - "Свободен" (зелёный/success)
  - "На линии" (синий/info)
  - "В ремонте" (жёлтый/warning)
  - "Просрочка" (красный/danger)
- **Штрафы:** 
  - "Новый" (серый/neutral)
  - "Начислен" (жёлтый/warning)
  - "Оплачен" (зелёный/success)
- **Ремонты:** 
  - "В работе" (синий/info)
  - "Завершён" (зелёный/success)
  - "Ожидает оплаты" (жёлтый/warning)

### 5.5. Инфо-карточки/метрики
- Используются на дашборде
- Отображают числовые показатели
- Ссылки на соответствующие реестры с фильтрами

### 5.6. Пустые состояния
- Текст: "Нет данных"
- Кнопка-заглушка (например, "Добавить")

### 5.7. Ошибки
- Текст: "Не удалось загрузить"
- Кнопка "Повторить" (JS-имитация перезагрузки)

### 5.8. Модалка подтверждения
- Простая модалка
- Для критичных действий (например, "Завершить выдачу")
- Кнопки "Подтвердить" / "Отмена"

### 5.9. Адаптация компонентов Gravity UI

**Принципы адаптации:**
1. Изучить компонент в [Storybook Gravity UI](https://preview.gravity-ui.com)
2. Взять цветовую схему и spacing из дизайн-системы
3. Реализовать HTML-структуру и CSS-стили вручную
4. Добавить vanilla JS для интерактивности

**Примеры компонентов для адаптации:**
- **Button:** view="action" (основная кнопка), view="normal" (вторичная)
- **Badge:** разные цвета для статусов
- **Table:** стили строк, hover, заголовки
- **Input/Select:** стили полей ввода
- **Card:** карточки метрик на дашборде
- **Tabs:** переключение вкладок
- **Alert:** уведомления и предупреждения

**Ресурсы:**
- Изучить компоненты в Storybook для понимания визуального стиля
- Использовать CSS переменные из Gravity UI для цветов
- Адаптировать размеры и spacing

---

## 6. Моковые сущности (mock-data.js)

### 6.1. Структура данных

**cars** (автомобили):
```javascript
[{
  id,                    // уникальный ID
  plate,                 // госномер
  brand,                 // марка
  model,                 // модель
  vin,                   // VIN номер
  sts,                   // СТС (свидетельство о регистрации)
  status,                // статус ТС
  currentDriver,         // текущий водитель (ФИО)
  mileage,               // пробег
  category,              // категория
  curator,               // куратор
  hasFines,              // есть штрафы (boolean)
  insuranceExpiringDays, // дней до окончания страховки
  hasDebt                // есть долг (boolean)
}]
```

**drivers** (водители):
```javascript
[{
  id,
  name,                  // ФИО
  status,
  currentCarPlate,       // текущее ТС (госномер)
  debtAmount,            // сумма задолженности
  balanceAmount,         // баланс
  rentRate,              // ставка аренды
  phone
}]
```

**fines** (штрафы):
```javascript
[{
  id,
  date,
  plate,                 // авто
  driverName,            // водитель
  amount,                // сумма
  status,
  discountAvailable,     // скидка доступна (boolean)
  discountDeadline,      // дедлайн скидки
  paidDate               // дата оплаты
}]
```

**serviceOrders** (заказ-наряды/ремонты):
```javascript
[{
  id,
  createdAt,
  plate,
  model,
  driverName,
  status,
  paymentStatus,
  mileage
}]
```

**inspections** (осмотры):
```javascript
[{
  id,
  date,
  plate,
  type,                  // "Выдача" / "Возврат"
  mechanicName,
  mileage,
  hasDamages,            // есть повреждения (boolean)
  notes

**users** (пользователи):
```javascript
[{
  id,
  name,                  // ФИО
  email,
  role,                  // "Партнёр" / "Механик"
  status,                // "Активен" / "Неактивен"
  createdAt              // дата создания
}]
```
}]
```

### 6.2. Требования к данным
- Значения должны показывать **разные состояния**:
  - У некоторых авто просрочка
  - У некоторых страховка на исходе
  - У некоторых штрафы
  - У некоторых водителей задолженность
- Минимум 10-15 записей в каждом массиве для демонстрации фильтров

---

## 7. Бизнес-логика в прототипе (ui-state.js)

Реализовать простые переключатели для демонстрации UI-поведения:

### 7.1. Toggle: "Просрочка > 2 суток"
- Показывает/скрывает алерт для выбранного авто/водителя
- Меняет бейдж статуса

### 7.2. Toggle: "Страховка истекает"
- Показывает алерт (если до окончания <= 10 дней)
- Меняет бейдж/индикатор

### 7.3. Toggle: "Есть задолженность"
- Показывает баннер
- Влияет на доступность некоторых действий (блокирует кнопки)

### 7.4. Toggle: "Штраф со скидкой"
- Показывает алерт с дедлайном
- Подсвечивает строку в таблице

**Важно:** Никаких реальных расчетов — только демонстрация поведения интерфейса.

---

## 8. Экраны для партнёра (Web)

### 8.1. partner/dashboard.html

**Цель:** оперативная картина бизнеса

**Элементы:**
- **Карточки-метрики ТС:**
  - ТС на линии
  - Свободны
  - В ремонте
  - В просрочке
- **Карточки финансы:**
  - Суммарная задолженность
  - Ожидается к выплате
- **Блок "Критические уведомления":**
  - Штрафы со скидкой
  - Страховки истекают
  - Просрочка > 2 суток

**Логика:**
- Каждый показатель — ссылка на соответствующий реестр с фильтром (через query string `?status=...`)

---

### 8.2. partner/cars.html (реестр автомобилей)

**Элементы:**
- **Кнопка "Добавить автомобиль"** (желтая кнопка `.btn--primary`) в заголовке страницы
- **Таблица:** Госномер, Модель, Статус ТС, Текущий водитель, Пробег, Категория, Куратор, Индикаторы (штрафы/долг/страховка)
- **Панель фильтров:**
  - Статус (dropdown)
  - Наличие штрафов (checkbox)
  - Просрочка (checkbox)
  - Страховка < 10 дней (checkbox)
- **Поиск по госномеру** (JS-фильтр по строке)

**Модальное окно добавления автомобиля:**
- Поля формы:
  - Госномер (обязательное)
  - Марка (обязательное)
  - Модель (обязательное)
  - VIN номер (необязательное)
  - СТС (необязательное)
  - Пробег (км, число)
  - Категория (Эконом / Комфорт)
  - Куратор (текст)
  - Дней до окончания страховки (число, по умолчанию: 365)
- Кнопки: "Добавить" (желтая) / "Отмена"
- **Примечание:** Статус не задаётся при добавлении, по умолчанию устанавливается "Свободен"

**Логика:**
- Клик по строке → `partner/car.html?id=...`
- Фильтры меняют видимые строки (JS)
- Добавление автомобиля через форму (данные добавляются в mockData.cars)
- Валидация формы (обязательные поля: госномер, марка, модель)
- После добавления автомобиль появляется в таблице, модалка закрывается, форма сбрасывается
- В таблице отображается: "Марка Модель" (например, "Toyota Camry")

---

### 8.3. partner/car.html (карточка ТС)

**Структура:**
- Заголовок: госномер, марка и модель, статус-бейджи
- **Вкладки:**
  1. Основное
  2. Аренды
  3. События
  4. Осмотры
  5. Страхование
  6. Комплектность
  7. Файлы

#### 8.3.1. Вкладка "Основное"
- Поля: госномер, VIN, СТС, марка, модель, год (заглушка), статус, текущий водитель, пробег, подразделение (заглушка)
- **Алерты:**
  - "Просрочка > 2 суток"
  - "Страховка истекает"

#### 8.3.2. Вкладка "Аренды"
- Таблица: период, водитель, ставка/сумма, пользователь (заглушка)

#### 8.3.3. Вкладка "События"
- Лента/таблица: дата, тип (ДТП/Повреждение/Ремонт/Осмотр), комментарий, ответственный

#### 8.3.4. Вкладка "Осмотры"
- Таблица: дата, тип (выдача/возврат), пробег, механик, результат (повреждения/комплектность)

#### 8.3.5. Вкладка "Страхование"
- Блоки: ОСАГО/КАСКО/ДСАГО
  - Номер полиса
  - Страховщик
  - Дата начала/окончания
  - Премия
- **Алерт** если до окончания <= 10 дней

#### 8.3.6. Вкладка "Комплектность"
- Таблица чек-листа: элемент, статус (есть/отсутствует)

#### 8.3.7. Вкладка "Файлы"
- Список файлов: тип, имя, дата, кнопка "Просмотр" (открывает модалку с placeholder)

**UI-состояния (кнопки для демонстрации):**
- "Симулировать: просрочка"
- "Симулировать: страховка истекает"
- "Симулировать: есть штрафы"

---

### 8.4. partner/drivers.html (реестр водителей)

**Элементы:**
- **Таблица:** ФИО, статус, текущее ТС, задолженность, баланс, ставка аренды
- **Фильтры:**
  - Есть задолженность (checkbox)
  - Статус (dropdown)
  - Поиск по ФИО (JS-фильтр)

**Логика:**
- Клик по строке → `partner/driver.html?id=...`

---

### 8.5. partner/driver.html (карточка водителя)

**Вкладки:**
1. Основное
2. Финансы
3. Штрафы
4. Документы

#### 8.5.1. Вкладка "Основное"
- ФИО, статус, телефон, текущее ТС, ставка аренды, организация/подразделение (заглушка)

#### 8.5.2. Вкладка "Финансы"
- Таблица операций: дата, тип, приход, расход, остаток, описание
- **Баннер:** "Есть задолженность" (если есть)

#### 8.5.3. Вкладка "Штрафы"
- Таблица штрафов водителя + статус

#### 8.5.4. Вкладка "Документы"
- Список сканов (паспорт/ВУ) + просмотр в модалке placeholder

**UI-состояния:**
- Переключатель "Есть задолженность" (показывает баннер и бейдж)

---

### 8.6. partner/fines.html (реестр штрафов)

**Элементы:**
- **Фильтры:**
  - Статус (dropdown)
  - Скидка доступна (checkbox)
  - Период (поля-заглушки)
- **Таблица:** дата, авто, водитель, сумма, статус, дедлайн скидки, дата оплаты

**Логика:**
- Клик по строке → `partner/fine.html?id=...`

---

### 8.7. partner/fine.html (карточка штрафа)

**Элементы:**
- **Основные поля:** номер протокола (заглушка), авто, водитель, дата/время, сумма, скидка, статус
- **Блок "История платежей"** (таблица-заглушка)
- **Блок "Фото/вложения"** (preview placeholder)

**UI-состояния:**
- Кнопка "Сменить статус" (dropdown): новый/начислен/оплачен
  - Меняет бейдж
  - Показывает дату оплаты, если оплачен

---

### 8.8. partner/service-orders.html (заказ-наряды/ремонты)

**Элементы:**
- **Таблица:** дата, статус ремонта, статус оплаты, авто, водитель, пробег
- **Фильтры:**
  - Статус ремонта (dropdown)
  - Статус оплаты (dropdown)

**Логика:**
- Фильтры по статусу ремонта и оплате (JS)
- **Пояснение:** ремонт = простой авто → влияет на статус ТС (в прототипе только подсказка/tooltip)

---

### 8.9. partner/reports.html

**Элементы:**
- **Список отчётов:**
  - "Баланс ТС"
  - "Касса"
  - "Реестр штрафов"
  - "Ведомость водителя"
- Для каждого — карточка: описание + кнопка "Скачать CSV"

**Требование:**
- Реализовать генерацию CSV через JS (Blob + link.click())
- Данные берутся из mock-data.js

---

## 9. Экраны для механика (Mobile)

### 8.10. partner/users.html (управление пользователями)

**Цель:** управление пользователями системы и назначение ролей

**Элементы:**
- **Таблица пользователей:**
  - ФИО
  - Email
  - Роль (Партнёр / Механик)
  - Статус (Активен / Неактивен)
  - Дата создания
  - Действия (удаление)
- **Панель фильтров:**
  - Фильтр по роли (dropdown)
  - Фильтр по статусу (dropdown)
  - Поиск по имени или email (JS-фильтр)
- **Кнопка "Добавить пользователя"** (желтая кнопка `.btn--primary`)

**Модальное окно добавления пользователя:**
- Поля формы:
  - ФИО (обязательное)
  - Email (обязательное)
  - Роль (обязательное, выбор: Партнёр / Механик)
  - Статус (по умолчанию: Активен)
- Кнопки: "Добавить" (желтая) / "Отмена"

**Логика:**
- Добавление пользователя через форму (данные добавляются в mockData.users)
- Фильтры меняют видимые строки (JS)
- Удаление пользователя с подтверждением
- Валидация формы (обязательные поля)

---

### 9.1. mechanic/home.html

**Цель:** список задач

**Элементы:**
- **Переключатель вкладок:** "Выдача" / "Приёмка"
- **Карточки задач:**
  - Авто
  - Водитель
  - Место (заглушка)
  - Время (заглушка)
  - Кнопка "Открыть"

**Логика:**
- "Открыть" ведёт на `issue.html` или `return.html` с id

---

### 9.2. mechanic/issue.html (выдача авто)

**Этапы (сверху прогресс-бар или stepper):**
1. **Шаг 1:** авто + водитель (select из мок-данных)
2. **Шаг 2:** фотофиксация
   - Загрузка 3 фото – `input type=file`
   - Превью миниатюр
3. **Шаг 3:** чек-лист
   - Список обязательных пунктов
   - Переключатели ok/not ok
4. **Шаг 4:** подпись
   - Canvas для подписи пальцем/мышью
   - Кнопка "Очистить"
5. **Шаг 5:** завершение
   - Кнопка "Завершить выдачу"

**Бизнес-правило:**
- "Завершить" **неактивна** пока не выполнены:
  - Минимум 1 фото
  - Все пункты чек-листа
  - Подпись

**После завершения:**
- Показать экран подтверждения "Выдача завершена"
- Ссылка "Назад к задачам"

---

### 9.3. mechanic/return.html (приёмка авто)

**Этапы:**
1. **Шаг 1:** авто/аренда (select авто)
2. **Шаг 2:** фотофиксация возврата (минимум 3 фото)
3. **Шаг 3:** повреждения/комплектность
   - Checkbox + комментарий
4. **Шаг 4:** завершение приёмки

**Бизнес-правило:**
- "Завершить" **неактивна** без фото

**После завершения:**
- Показать "Приёмка завершена"
- Ссылка "История осмотров"

---

### 9.4. mechanic/inspections.html (история осмотров)

**Элементы:**
- **Список осмотров:** дата, авто, тип, результат
- **Фильтр по авто** (dropdown)
- Клик по записи открывает модалку с деталями (фото placeholder, заметки)

---

## 10. UX/Доступность

### 10.1. Mobile-оптимизация
| 2024 | 2.3 | Кузнецов Игорь | Добавлен раздел "Управление пользователями" |
| 2024 | 2.4 | Кузнецов Игорь | Добавлен функционал добавления автомобиля в раздел автомобилей |
| 2024 | 2.5 | Кузнецов Игорь | Обновлена форма добавления: разделены марка и модель, добавлены VIN и СТС, убран статус |
- Кнопки должны быть достаточно крупными (минимум 44x44px)
- Формы — вертикальные, без таблиц
- Удобная навигация большим пальцем

### 10.2. Подсказки и валидация
- Везде используйте подсказки: "Обязательно", "Нельзя завершить без фото/подписи"
- Визуальная индикация обязательных полей
- Блокировка кнопок с пояснением, почему неактивна

### 10.3. Обратная связь
- Показывать состояние загрузки (если имитируется)
- Показывать успешные действия (toast/уведомление)
- Показывать ошибки с понятным текстом

---

## 11. Definition of Done (Готовность)

### 11.1. Обязательные требования
- ✅ Все страницы созданы по структуре
- ✅ Есть навигация и активные пункты меню
- ✅ Есть мок-данные и отображение разных статусов
- ✅ Есть JS-фильтры, табы, модалки
- ✅ В механике реализованы:
  - Загрузка фото с превью
  - Подпись на canvas
  - Блокировка кнопки завершения
- ✅ В отчётах реализована выгрузка CSV
- ✅ Прототип открывается локально без ошибок

### 11.2. Проверка
- Открыть `index.html` двойным кликом
- Проверить все ссылки
- Проверить фильтры и поиск
- Проверить модалки
- Проверить загрузку фото и подпись
- Проверить выгрузку CSV
- Проверить адаптивность (Web/Mobile)

---

## 12. История изменений

| Дата | Версия | Автор | Описание изменений |
|------|--------|-------|-------------------|
| 2024 | 2.0 | Кузнецов Игорь | Создание ТЗ для HTML-прототипа B2P |
| 2024 | 2.1 | Кузнецов Игорь | Добавлена дизайн-система Gravity UI как референс |
| 2024 | 2.2 | Кузнецов Игорь | Удалён раздел "Настройки" для партнёра |