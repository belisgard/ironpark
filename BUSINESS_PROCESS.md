# Бизнес-процесс: Аренда автомобиля от выбора до выдачи механику

## Версия документа: 1.0
**Дата создания:** 2025-01-XX  
**Автор:** Анализ на основе прототипа B2P платформы

---

## Оглавление

1. [Общее описание процесса](#общее-описание-процесса)
2. [Этап 1: Выбор клиентом арендного автомобиля](#этап-1-выбор-клиентом-арендного-автомобиля)
3. [Этап 2: Формирование договора менеджером](#этап-2-формирование-договора-менеджером)
4. [Этап 3: Проверка и внесение паспортных данных клиента менеджером](#этап-3-проверка-и-внесение-паспортных-данных-клиента-менеджером)
5. [Этап 4: Генерация и распечатка договора](#этап-4-генерация-и-распечатка-договора)
6. [Этап 5: Подписание договора клиентом](#этап-5-подписание-договора-клиентом)
7. [Этап 6: Загрузка подписанного скана договора в систему](#этап-6-загрузка-подписанного-скана-договора-в-систему)
8. [Этап 7: Отправка механику для выдачи авто](#этап-7-отправка-механику-для-выдачи-авто)
9. [Этап 8: Процесс выдачи автомобиля механиком](#этап-8-процесс-выдачи-автомобиля-механиком)
10. [Схема статусов договора](#схема-статусов-договора)
11. [Схема статусов выдачи](#схема-статусов-выдачи)
12. [Кейсы использования](#кейсы-использования)
13. [Обработка ошибок и отклонений](#обработка-ошибок-и-отклонений)

---

## Общее описание процесса

Бизнес-процесс описывает полный цикл аренды автомобиля от момента выбора клиентом (водителем) арендного транспортного средства до фактической выдачи автомобиля механиком. Процесс включает следующие ключевые этапы:

1. **Выбор клиентом арендного авто** (`car-selection/index.html`)
2. **Формирование договора менеджером** (`partner/contracts.html`) — данные клиента и автомобиля автоматически подставляются
3. **Проверка и внесение паспортных данных менеджером** (`partner/driver.html`) — клиент подходит к менеджеру
4. **Генерация и распечатка договора** (`partner/contract.html`)
5. **Подписание договора клиентом** — клиент подписывает распечатанный договор
6. **Сканирование и загрузка подписанного договора** (`partner/contract.html`) — **загружается только подписанный вариант**
7. **Отправка механику** (изменение статуса выдачи на "авто выдано")
8. **Выдача автомобиля механиком** (`mechanic/issue.html`)

### Ключевые особенности процесса

- **Данные автоматически подставляются** из выбора клиента при создании договора
- **Клиент подходит к менеджеру** для проверки данных и внесения паспортных данных
- **Договор генерируется** после заполнения всех данных менеджером
- **Загружается только подписанный вариант договора** — неподписанные черновики не загружаются в систему

---

## Этап 1: Выбор клиентом арендного автомобиля

### Описание
Клиент (водитель) выбирает арендное транспортное средство из доступного парка через интерфейс выбора авто. Выбранные данные автоматически используются для формирования договора.

### Интерфейс
- **Страница:** `car-selection/index.html`
- **Переключатель:** "Собственное авто" / "Арендное авто"

### Процесс для "Арендное авто"

1. **Выбор автомобиля из списка**
   - Отображается выпадающий список: "Марка Модель - Госномер"
   - Пример: "Changan ALSVIN - K477MB122"
   - Список формируется из доступных автомобилей с статусом "Свободен"

2. **Автоматическое заполнение данных**
   - **Пробег** — автоматически заполняется из данных автомобиля (readonly)
   - **Стоимость аренды в сутки** — автоматически отображается из договора или устанавливается по умолчанию

3. **Отображение информации**
   - Показывается пробег: "82907 км" (readonly)
   - Показывается стоимость аренды: "2 550 ₽ / сутки"

4. **Подтверждение выбора**
   - Нажатие кнопки "Продолжить"
   - Данные сохраняются (в прототипе — alert с подтверждением)

### Данные, передаваемые далее
- ID выбранного автомобиля
- Госномер автомобиля
- Марка и модель
- Пробег
- Стоимость аренды в сутки
- Дата выбора
- Данные клиента (из профиля водителя)

**Важно:** Все эти данные автоматически подставляются в договор при его создании менеджером.

---

## Этап 2: Формирование договора менеджером

### Описание
Менеджер (партнёр) создаёт договор аренды на основе выбранного клиентом автомобиля. Данные клиента и автомобиля автоматически подставляются в договор.

### Интерфейс
- **Страница:** `partner/contracts.html`
- **Действие:** Кнопка "+ Добавить договор"

### Процесс

1. **Автоматическое заполнение данных из выбора клиента**
   - **Водитель (клиент)** — выбирается из списка (клиент, выбравший авто, уже указан в системе)
   - **Транспортное средство** — выбирается из списка (выбранное клиентом авто автоматически подставляется)
   - **Марка/Модель** — автоматически заполняется из данных ТС
   - **Госномер** — автоматически заполняется из данных ТС
   - **Пробег** — автоматически заполняется из данных ТС
   - **Стоимость аренды в сутки** — автоматически определяется из данных ТС или договора

2. **Заполнение данных договора менеджером**
   - **Номер договора** (обязательно): генерируется автоматически или вводится вручную (например, "ДР-2024-001")
   - **Начало действия** (обязательно): дата начала аренды
   - **Окончание действия** (опционально): дата окончания аренды

3. **Создание договора**
   - При нажатии "Добавить" создаётся новый договор
   - **Начальный статус договора:** `contractStatus: 'новый'`
   - **Статус действия:** `status: 'действующий'` (если дата окончания не указана или в будущем)
   - **Статус выдачи:** `issuanceStatus: null`

4. **Автоматические поля**
   - Дата создания: текущая дата/время
   - Автоматическое заполнение названия ТС из выбранного автомобиля
   - Автоматическое заполнение имени водителя из выбранного водителя

### Результат
Договор создан со статусом **"новый"**, данные клиента и автомобиля автоматически подставлены в договор.

---

## Этап 3: Проверка и внесение паспортных данных клиента менеджером

### Описание
Клиент подходит к менеджеру. Менеджер проверяет данные клиента и вносит паспортные данные, необходимые для договора.

### Интерфейс
- **Страница:** `partner/driver.html`
- **Вкладка:** "Основное" → кнопка "Редактировать"
- **Альтернатива:** Редактирование данных водителя может происходить непосредственно при создании/редактировании договора

### Процесс

1. **Клиент подходит к менеджеру**
   - Клиент приходит с выбранным автомобилем
   - Менеджер открывает договор, созданный на основе выбора клиента

2. **Проверка данных клиента**
   - Менеджер проверяет ФИО клиента
   - Менеджер проверяет телефон клиента
   - Менеджер проверяет основные данные клиента

3. **Внесение паспортных данных**
   - **Серия/номер паспорта** (без пробелов)
   - **Гражданство**
   - **Кем выдан**
   - **Дата выдачи**
   - **Действителен до**
   - **Код подразделения**
   - **Дата рождения**
   - **Место рождения**
   - **Адрес регистрации**

4. **Проверка/внесение СНИЛС**
   - Номер СНИЛС

5. **Проверка/внесение водительских прав**
   - Серия/номер прав
   - Дата выдачи
   - Действителен до
   - Дата начала стажа

6. **Сохранение данных**
   - Менеджер сохраняет все внесённые данные
   - Данные привязываются к договору

### Важно
- Все паспортные данные заполняются менеджером лично при встрече с клиентом
- Данные проверяются менеджером на соответствие предъявленным документам

---

## Этап 4: Генерация и распечатка договора

### Описание
После проверки данных клиента и внесения паспортных данных менеджер генерирует договор и распечатывает его для подписания клиентом.

### Интерфейс
- **Страница:** `partner/contract.html`
- **Действие:** Кнопка "Распечатать"

### Процесс

1. **Генерация договора**
   - Менеджер проверяет, что все данные заполнены:
     - Данные клиента (ФИО, телефон)
     - Паспортные данные клиента
     - Данные автомобиля (марка, модель, госномер, пробег)
     - Параметры договора (даты, стоимость аренды)
   - Система генерирует договор со всеми внесёнными данными

2. **Подготовка к печати**
   - Менеджер открывает страницу договора (`partner/contract.html`)
   - Используется функция печати браузера (`window.print()`)
   - Активируются специальные стили для печати (скрываются кнопки, навигация)

3. **Печать договора**
   - Договор печатается на принтере
   - Договор содержит все необходимые данные и поля для подписи

### Важно
- Договор генерируется только после заполнения всех обязательных полей
- Распечатанный договор содержит все данные клиента и автомобиля

---

## Этап 5: Подписание договора клиентом

### Описание
Клиент подписывает распечатанный договор. После подписания договор сканируется и загружается в систему.

### Процесс

1. **Подписание договора клиентом**
   - Клиент подписывает распечатанный экземпляр договора
   - Подпись ставится в специально отведённом месте договора

2. **Сканирование подписанного договора**
   - Менеджер сканирует подписанный договор (или делает фото)
   - Получается изображение или PDF файл подписанного договора

### Важно
- Подписывается только клиент (водитель)
- Подпись менеджера может быть на договоре, но основная подпись — клиента

---

## Этап 6: Загрузка подписанного скана договора в систему

### Описание
После сканирования подписанного договора менеджер загружает скан в систему. В систему загружается **только подписанный вариант** договора.

### Интерфейс
- **Страница:** `partner/contract.html`
- **Действие:** Кнопка "Загрузить скан договора"

### Процесс

1. **Выбор файла подписанного договора**
   - Менеджер выбирает отсканированный/сфотографированный подписанный договор
   - Поддерживаемые форматы: изображения (JPG, PNG, GIF) и PDF
   - Максимальный размер: 10 МБ

2. **Загрузка в систему**
   - Файл читается через FileReader как Data URL
   - Сохраняется в объекте договора: `contract.scan = dataUrl`
   - Сохраняется тип файла: `contract.scanType = 'image' | 'pdf'`

3. **Отображение загруженного скана**
   - Изображения отображаются через `<img>` с максимальной высотой 500px
   - PDF отображается через `<iframe>` с высотой 600px
   - Для PDF добавляется ссылка "Открыть скан договора в новом окне"

4. **Изменение статуса договора**
   - После загрузки подписанного скана менеджер меняет статус договора на **"подписанный скан загружен"**
   - Через модальное окно "Редактирование договора" → поле "Статус договора"

5. **Возможность удаления**
   - Кнопка "Удалить скан" удаляет загруженный файл (при необходимости замены)

### Важно
- **В систему загружается только подписанный вариант договора**
- Не подписанные черновики или варианты договора не загружаются
- Загрузка скана и изменение статуса на "подписанный скан загружен" выполняются после сканирования подписанного договора

### Результат
- Статус договора: **"подписанный скан загружен"**
- Подписанный скан загружен в систему
- Договор готов к отправке механику для выдачи авто

---

## Этап 7: Отправка механику для выдачи авто

### Описание
После загрузки подписанного скана договора менеджер изменяет статус выдачи на "авто выдано", что создаёт задачу для механика.

### Интерфейс
- **Страница:** `partner/contract.html`
- **Действие:** Редактирование через модальное окно "Редактирование договора" → поле "Выдача"

### Процесс

1. **Проверка готовности**
   - Статус договора: **"подписанный скан загружен"**
   - Подписанный скан загружен в систему
   - Все данные клиента заполнены и проверены

2. **Изменение статуса выдачи**
   - Менеджер открывает модальное окно "Редактирование договора"
   - Выбирает в поле "Выдача": **"Авто выдано"**
   - Сохраняет изменения

3. **Создание задачи для механика**
   - В системе создаётся запись о необходимости выдачи авто
   - Задача появляется в интерфейсе механика (`mechanic/home.html` → вкладка "Выдача")

### Данные задачи для механика
- **Автомобиль:** госномер и модель (из договора)
- **Водитель (клиент):** ФИО водителя (из договора)
- **Место:** указывается партнёром или автоматически
- **Время:** указывается партнёром или автоматически
- **Ссылка на договор:** доступ к информации о договоре и скану

### Результат
- Статус выдачи: `issuanceStatus: 'авто выдано'`
- Задача появилась в интерфейсе механика
- Механик получает всю необходимую информацию о клиенте и автомобиле

---

## Этап 8: Процесс выдачи автомобиля механиком

### Описание
Механик выполняет процедуру выдачи автомобиля водителю по пошаговому процессу.

### Интерфейс
- **Страница:** `mechanic/home.html` → вкладка "Выдача" → кнопка "Открыть"
- **Процесс:** `mechanic/issue.html`

### Шаг 1: Авто и водитель

1. **Выбор автомобиля**
   - Выпадающий список с доступными автомобилями для выдачи
   - Отображается: "А123БВ777 - Toyota Camry"

2. **Выбор водителя**
   - Выпадающий список с водителями
   - Отображается: "Иванов Иван Иванович"

3. **Переход к следующему шагу**
   - Кнопка "Далее"

### Шаг 2: Фотофиксация

1. **Загрузка фото**
   - Минимум 1 фото (можно больше)
   - Форматы: изображения (через `accept="image/*"`)

2. **Предпросмотр**
   - Отображается сетка 3x3 с превью загруженных фотографий
   - Каждое фото показывается в миниатюре (100px высота)

3. **Валидация**
   - Кнопка "Далее" активна только при наличии хотя бы 1 фото

### Шаг 3: Чек-лист

1. **Проверка комплектности и состояния**
   - ☑ Комплектность полная
   - ☑ Нет повреждений
   - ☑ Техническое состояние в норме

2. **Обязательные проверки**
   - Все три чекбокса должны быть отмечены для продолжения

3. **Переход к подписи**
   - Кнопка "Далее" активна только при отмеченных всех трёх чекбоксах

### Шаг 4: Подпись

1. **Получение подписи водителя**
   - Canvas для рисования подписи водителя
   - Поддержка мыши и touch-событий
   - Размер: 100% ширины, 200px высоты

2. **Действия**
   - Кнопка "Очистить" для сброса подписи
   - Кнопка "Далее" активна только при наличии подписи

### Шаг 5: Завершение

1. **Проверка всех данных**
   - Отображается экран с просьбой проверить все данные

2. **Финализация**
   - Кнопка "Завершить выдачу" (активна только при выполнении всех предыдущих шагов)

3. **Результат**
   - Отображается экран успеха: "Выдача завершена"
   - Кнопка "Назад к задачам" возвращает к списку задач

### Данные, сохраняемые при выдаче

- Дата и время выдачи
- ID автомобиля
- ID водителя
- Фотографии (массив файлов)
- Результаты чек-листа (все три пункта выполнены)
- Подпись водителя (изображение canvas)
- Механик, выполнивший выдачу

---

## Схема статусов договора

### Статусы договора (`contractStatus`)

1. **"новый"** (синий badge)
   - Начальный статус при создании договора
   - Договор создан, но требует дальнейших действий

2. **"требуется заполнение паспорта"** (жёлтый badge)
   - Требуется заполнение или проверка паспортных данных водителя
   - Переход: партнёр изменяет статус вручную

3. **"требуется подписание"** (жёлтый badge)
   - Договор готов к подписанию
   - Все данные заполнены, требуется подпись водителя и партнёра

4. **"подписанный скан загружен"** (зелёный badge)
   - Договор подписан и подписанный скан загружен в систему
   - Договор готов к выдаче авто

### Статус действия (`status`)

- **"действующий"** (зелёный badge) — договор активен
- **"истекший"** (серый badge) — договор завершён (дата окончания в прошлом)

### Статус выдачи (`issuanceStatus`)

- **`null`** или **"Не указано"** — авто не выдано
- **"авто выдано"** (зелёный badge) — авто выдано водителю
- **"авто принято"** (жёлтый badge) — авто принято обратно от водителя

### Визуализация статусов договора

На странице договора (`partner/contract.html`) отображается список всех возможных статусов с индикацией текущего:
- Текущий статус выделяется цветным фоном и жирным шрифтом
- Рядом с текущим статусом отображается цветная точка (зелёная для активного, серая для неактивных)

---

## Схема статусов выдачи

### Процесс изменения статусов выдачи

```
null → "авто выдано" → "авто принято"
```

1. **Начальное состояние**: `issuanceStatus: null`
   - Авто ещё не выдано

2. **После создания задачи для механика**: `issuanceStatus: "авто выдано"`
   - Партнёр устанавливает статус через редактирование договора
   - Задача появляется в интерфейсе механика

3. **После фактической выдачи механиком**:
   - Статус остаётся **"авто выдано"**
   - Механик завершает процесс выдачи через `mechanic/issue.html`

4. **После приёмки авто обратно**: `issuanceStatus: "авто принято"`
   - Механик выполняет приёмку через `mechanic/return.html`
   - Партнёр может вручную изменить статус на "авто принято"

---

## Кейсы использования

### Кейс 1: Успешный полный процесс

**Сценарий:**
1. Клиент (водитель) выбирает арендное авто через `car-selection/index.html`
2. Данные клиента и автомобиля автоматически подставляются в договор
3. Менеджер создаёт договор со статусом "новый"
4. Клиент подходит к менеджеру
5. Менеджер проверяет данные клиента
6. Менеджер вносит паспортные данные клиента
7. Менеджер генерирует договор (все данные заполнены)
8. Менеджер распечатывает договор через кнопку "Распечатать"
9. Клиент подписывает распечатанный договор
10. Менеджер сканирует подписанный договор
11. Менеджер загружает подписанный скан в систему через "Загрузить скан договора"
12. Менеджер меняет статус на "подписанный скан загружен"
13. Менеджер устанавливает статус выдачи на "авто выдано"
14. Задача появляется у механика
15. Механик выполняет выдачу (выбор авто/водителя, фото, чек-лист, подпись)
16. Выдача завершена

**Результат:** Автомобиль успешно выдан клиенту, все документы в порядке.

---

### Кейс 2: Договор создан без предварительного выбора клиентом (оффлайн процесс)

**Сценарий:**
1. Клиент обращается к менеджеру очно, без предварительного выбора через интерфейс
2. Менеджер напрямую создаёт договор через `partner/contracts.html`
3. Менеджер выбирает клиента из списка водителей
4. Менеджер выбирает доступное ТС из списка
5. Менеджер проверяет и вносит паспортные данные клиента
6. Остальные этапы выполняются как в Кейсе 1 (генерация, печать, подписание, загрузка подписанного скана)

**Особенность:** Этап выбора клиентом арендного авто через интерфейс пропущен, но процесс создания договора и загрузки подписанного скана остаётся таким же.

---

### Кейс 3: Замена подписанного скана (исправление)

**Сценарий:**
1. Договор создан, паспортные данные внесены
2. Договор распечатан и подписан клиентом
3. Менеджер сканирует и загружает подписанный скан
4. Менеджер обнаруживает, что скан некачественный или неполный
5. Менеджер удаляет загруженный скан через кнопку "Удалить скан"
6. Менеджер повторно сканирует договор
7. Менеджер загружает новый качественный скан

**Особенность:** Возможна замена подписанного скана при необходимости, но в системе всегда должен быть только подписанный вариант.

---

### Кейс 4: Паспортные данные клиента уже есть в системе

**Сценарий:**
1. Клиент выбирает арендное авто
2. Менеджер создаёт договор (данные клиента и авто подставляются автоматически)
3. Клиент подходит к менеджеру
4. Менеджер проверяет паспортные данные клиента — они уже заполнены в системе
5. Менеджер проверяет, что данные актуальны и соответствуют предъявленным документам
6. Менеджер генерирует и распечатывает договор
7. Клиент подписывает договор
8. Менеджер сканирует и загружает подписанный скан
9. Процесс продолжается как обычно

**Особенность:** Менеджер всё равно проверяет данные при встрече с клиентом, даже если они уже есть в системе.

---

### Кейс 5: Договор с собственным авто водителя

**Сценарий:**
1. На этапе выбора авто водитель выбирает "Собственное авто"
2. Заполняет данные из СТС (регистрационный знак, год, марка, цвет, модель)
3. Партнёр создаёт договор, но не привязывает к ТС из парка
4. Остальные этапы выполняются аналогично

**Особенность:** Для собственного авто не требуется статус выдачи "авто выдано".

---

### Кейс 6: Досрочное завершение договора

**Сценарий:**
1. Договор действующий, статус выдачи "авто выдано"
2. Водитель возвращает авто
3. Механик выполняет приёмку через `mechanic/return.html`
4. Партнёр изменяет статус выдачи на "авто принято"
5. Партнёр может изменить дату окончания действия договора

**Результат:** Договор завершён досрочно, авто принято обратно.

---

### Кейс 7: Отклонение при выдаче (механик обнаружил проблему)

**Сценарий:**
1. Партнёр установил статус выдачи "авто выдано"
2. Задача появилась у механика
3. Механик начинает процесс выдачи
4. На шаге "Чек-лист" механик обнаруживает повреждение или некомплект
5. Механик не может отметить "Нет повреждений" или "Комплектность полная"
6. Процесс выдачи блокируется

**Действия:**
- Механик возвращается к шагу выбора авто
- Механик сообщает партнёру о проблеме
- Партнёр может отменить задачу (изменить статус выдачи обратно на `null`)
- Партнёр решает проблему (ремонт, комплектация)
- После решения проблемы процесс повторяется

---

### Кейс 8: Приёмка авто с повреждениями

**Сценарий:**
1. Водитель возвращает авто
2. Механик выполняет приёмку через `mechanic/return.html`
3. Шаг 3: Механик отмечает чекбоксы:
   - ☑ Поврежден
   - ☑ Некомплект (если применимо)
   - ☑ Утери документов (если применимо)
4. Механик загружает минимум 3 фото повреждений
5. Механик добавляет комментарий с описанием

**Результат:**
- Запись о приёмке создана
- Партнёр видит информацию о повреждениях/некомплекте
- Может быть создан заказ-наряд на ремонт

---

### Кейс 9: Повторная выдача (продление договора)

**Сценарий:**
1. Договор завершён, авто принято
2. Партнёр продлевает договор (изменяет дату окончания)
3. Партнёр устанавливает статус выдачи на "авто выдано"
4. Задача появляется у механика
5. Механик выполняет выдачу заново

**Особенность:** Для продления может не требоваться повторное подписание, если это оговорено в договоре.

---

### Кейс 10: Ошибка при загрузке подписанного скана

**Сценарий:**
1. Клиент подписал договор
2. Менеджер сканирует подписанный договор
3. Менеджер пытается загрузить скан в систему
4. Файл слишком большой (>10 МБ) или неподдерживаемый формат
5. Система показывает ошибку: "Размер файла не должен превышать 10 МБ" или "Пожалуйста, выберите изображение (JPG, PNG, GIF) или PDF файл"
6. Менеджер повторно сканирует договор с другими настройками (меньшее разрешение или в другом формате)
7. Менеджер успешно загружает корректный файл

**Обработка:** Валидация файла выполняется на клиенте перед загрузкой. Важно получить качественный скан подписанного договора для загрузки в систему.

---

## Обработка ошибок и отклонений

### Ошибки на этапе создания договора

**Проблема:** Водитель или ТС не выбраны  
**Решение:** Система показывает alert "Ошибка: не найден водитель или ТС"

**Проблема:** Дата окончания в прошлом  
**Решение:** Статус действия автоматически устанавливается "истекший"

---

### Ошибки на этапе загрузки подписанного скана

**Проблема:** Файл больше 10 МБ  
**Решение:** Alert "Размер файла не должен превышать 10 МБ", файл не загружается. Менеджер должен повторно отсканировать договор с меньшим разрешением.

**Проблема:** Неподдерживаемый формат  
**Решение:** Alert "Пожалуйста, выберите изображение (JPG, PNG, GIF) или PDF файл". Менеджер должен сохранить скан в поддерживаемом формате.

**Проблема:** Ошибка чтения файла  
**Решение:** Alert "Ошибка при загрузке файла". Менеджер должен повторить загрузку.

**Проблема:** Загружен неподписанный договор  
**Решение:** Менеджер должен удалить загруженный файл и загрузить правильный подписанный скан. В системе должен храниться только подписанный вариант договора.

---

### Ошибки на этапе выдачи

**Проблема:** Фото не загружены  
**Решение:** Кнопка "Далее" на шаге 2 неактивна

**Проблема:** Чек-лист не пройден  
**Решение:** Кнопка "Далее" на шаге 3 неактивна, все три чекбокса должны быть отмечены

**Проблема:** Подпись отсутствует  
**Решение:** Кнопка "Далее" на шаге 4 неактивна

---

### Отклонения процесса

**Отмена задачи выдачи:**
- Менеджер может изменить статус выдачи с "авто выдано" обратно на `null`
- Задача исчезает из интерфейса механика

**Несоответствие данных:**
- Если на этапе выдачи механик выбирает другого водителя или авто, система должна предупредить или заблокировать несоответствие

**Досрочное завершение договора:**
- При изменении даты окончания на прошедшую дату, статус действия меняется на "истекший"

---

## Диаграмма процесса (текстовая)

```
[Водитель выбирает арендное авто]
         ↓
[Партнёр создаёт договор: статус "новый"]
         ↓
[Партнёр заполняет паспортные данные]
         ↓
[Партнёр: статус → "требуется подписание"]
         ↓
[Партнёр загружает скан договора (опционально)]
         ↓
[Партнёр распечатывает договор]
         ↓
[Водитель и партнёр подписывают договор]
         ↓
[Партнёр загружает подписанный скан]
         ↓
[Партнёр: статус → "подписанный скан загружен"]
         ↓
[Партнёр: статус выдачи → "авто выдано"]
         ↓
[Задача появляется у механика]
         ↓
[Механик: Шаг 1 - Выбор авто/водителя]
         ↓
[Механик: Шаг 2 - Фотофиксация (минимум 1 фото)]
         ↓
[Механик: Шаг 3 - Чек-лист (все 3 пункта отмечены)]
         ↓
[Механик: Шаг 4 - Подпись водителя]
         ↓
[Механик: Шаг 5 - Завершение выдачи]
         ↓
[Выдача завершена ✅]
```

---

## Дополнительные замечания

### Автоматизация

В текущем прототипе большинство переходов между статусами выполняются вручную менеджером. В реальной системе возможна автоматизация:

- Автоматическая подстановка данных клиента и автомобиля из выбора клиента
- Автоматическое создание задачи для механика при установке статуса "авто выдано"
- Уведомления клиенту и механику о смене статусов
- Автоматическая смена статуса на "подписанный скан загружен" после успешной загрузки файла

### Интеграции

Процесс может быть интегрирован с:

- Системой электронного документооборота для подписания
- SMS/Email уведомлениями
- Системой учёта времени и местоположения
- Камерами для автоматической фотофиксации

### Безопасность

- Все действия должны логироваться с указанием пользователя и времени
- Загрузка файлов должна проходить валидацию на сервере
- Доступ к договорам должен контролироваться правами доступа

---

## Заключение

Данный документ описывает полный бизнес-процесс аренды автомобиля на основе анализа HTML-прототипа B2P платформы. Процесс включает 8 основных этапов от выбора водителем арендного авто до фактической выдачи механиком.

Процесс поддерживает различные сценарии использования, включая обработку ошибок и отклонений. Все статусы и переходы четко определены и могут быть реализованы в полноценной системе на основе данного прототипа.
