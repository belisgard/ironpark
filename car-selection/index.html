<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–î–∞–Ω–Ω—ã–µ –∏–∑ –°–¢–° - –®–∞–≥ –≤—ã–±–æ—Ä–∞ –∞–≤—Ç–æ</title>
  <link rel="stylesheet" href="../assets/css/gravity-theme.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <style>
    body {
      background-color: #F5F5F5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      margin: 0;
    }

    .form-card {
      background: white;
      border-radius: 16px;
      padding: 32px;
      max-width: 900px;
      width: 100%;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .car-type-toggle {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      padding: 4px;
      background: var(--g-color-base-generic);
      border-radius: 8px;
      width: fit-content;
    }

    .car-type-button {
      padding: 8px 16px;
      border: none;
      background: transparent;
      border-radius: 6px;
      font-size: var(--g-font-size-md);
      font-weight: 500;
      cursor: pointer;
      color: var(--g-color-text-secondary);
      transition: all 0.2s;
    }

    .car-type-button.active {
      background: white;
      color: var(--g-color-text-primary);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .rental-info {
      background: var(--g-color-base-generic);
      padding: 16px;
      border-radius: 8px;
      margin-top: 16px;
    }

    .rental-price {
      font-size: var(--g-font-size-lg);
      font-weight: 600;
      color: #FF3D00;
      margin-top: 8px;
    }

    .form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--g-color-line-generic);
    }

    .form-header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .back-button {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--g-color-text-primary);
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .back-button:hover {
      background: var(--g-color-base-generic);
      border-radius: 50%;
    }

    .form-title {
      font-size: var(--g-font-size-xl);
      font-weight: 600;
      margin: 0;
      color: var(--g-color-text-primary);
    }

    .progress-section {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .progress-bar {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    .progress-segment {
      width: 40px;
      height: 4px;
      border-radius: 2px;
      background: var(--g-color-line-generic);
    }

    .progress-segment.active {
      background: #FF3D00;
    }

    .progress-text {
      font-size: var(--g-font-size-sm);
      color: var(--g-color-text-secondary);
      white-space: nowrap;
    }

    .form-subtitle {
      font-size: var(--g-font-size-md);
      color: var(--g-color-text-secondary);
      margin-bottom: 32px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin-bottom: 32px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-label {
      font-size: var(--g-font-size-sm);
      color: var(--g-color-text-primary);
      margin-bottom: 8px;
      font-weight: 500;
    }

    .form-label .required {
      color: #FF3D00;
      margin-left: 2px;
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--g-color-line-generic);
      border-radius: 8px;
      font-size: var(--g-font-size-md);
      background: white;
      transition: border-color 0.2s;
    }

    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: #FF3D00;
    }

    .form-input[readonly] {
      background: var(--g-color-base-generic);
      cursor: not-allowed;
      color: var(--g-color-text-secondary);
    }

    .form-input[readonly]:focus {
      border-color: var(--g-color-line-generic);
    }

    .form-select-wrapper {
      position: relative;
    }

    .form-select-wrapper::after {
      content: '‚ñº';
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      color: var(--g-color-text-hint);
      font-size: 12px;
    }

    .date-input-wrapper {
      position: relative;
    }

    .date-input-wrapper::after {
      content: 'üìÖ';
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      font-size: 16px;
    }

    .continue-button {
      width: 100%;
      padding: 16px;
      background: #FF3D00;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: var(--g-font-size-lg);
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .continue-button:hover {
      background: #E63400;
    }

    .continue-button:active {
      background: #CC2E00;
    }

    .footer-actions {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      margin-top: 32px;
    }

    .support-button {
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: background-color 0.2s;
      box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
    }

    .support-button:hover {
      background: #45a049;
    }

    .logout-link {
      color: var(--g-color-text-secondary);
      text-decoration: none;
      font-size: var(--g-font-size-sm);
      cursor: pointer;
      transition: color 0.2s;
    }

    .logout-link:hover {
      color: var(--g-color-text-primary);
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }

      .form-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }

      .progress-section {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body>
  <div class="form-card">
    <div class="form-header">
      <div class="form-header-left">
        <button class="back-button" onclick="window.history.back()">‚Äπ</button>
        <h1 class="form-title">–î–∞–Ω–Ω—ã–µ –∏–∑ –°–¢–°</h1>
      </div>
      <div class="progress-section">
        <div class="progress-bar">
          <div class="progress-segment active"></div>
          <div class="progress-segment"></div>
          <div class="progress-segment"></div>
          <div class="progress-segment"></div>
        </div>
        <span class="progress-text">–≠—Ç–∞–ø 3 –∏–∑ 4</span>
      </div>
    </div>

    <div class="car-type-toggle">
      <button type="button" class="car-type-button active" id="ownCarBtn" onclick="toggleCarType('own')">
        –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∞–≤—Ç–æ
      </button>
      <button type="button" class="car-type-button" id="rentalCarBtn" onclick="toggleCarType('rental')">
        –ê—Ä–µ–Ω–¥–Ω–æ–µ –∞–≤—Ç–æ
      </button>
    </div>

    <p class="form-subtitle" id="formSubtitle">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞</p>

    <form id="stsForm" onsubmit="handleSubmit(event)">
      <div class="form-grid">
        <!-- Own car fields -->
        <div id="ownCarFields">
          <div class="form-group">
            <label class="form-label">
              –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–Ω–∞–∫<span class="required">*</span>
            </label>
            <input 
              type="text" 
              class="form-input" 
              id="registrationMark" 
              value="–í 113 –£–£ 13"
              placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–Ω–∞–∫"
            >
          </div>

          <div class="form-group">
            <label class="form-label">
              –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è<span class="required">*</span>
            </label>
            <div class="date-input-wrapper">
              <input 
                type="date" 
                class="form-input" 
                id="productionYear" 
                placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É"
              >
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              –ú–∞—Ä–∫–∞<span class="required">*</span>
            </label>
            <div class="form-select-wrapper">
              <select class="form-select" id="carBrand">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              –¶–≤–µ—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª—è<span class="required">*</span>
            </label>
            <div class="form-select-wrapper">
              <select class="form-select" id="carColor">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç</option>
                <option value="–ë–µ–ª—ã–π">–ë–µ–ª—ã–π</option>
                <option value="–ß—ë—Ä–Ω—ã–π">–ß—ë—Ä–Ω—ã–π</option>
                <option value="–°–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–π">–°–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–π</option>
                <option value="–°–µ—Ä—ã–π">–°–µ—Ä—ã–π</option>
                <option value="–°–∏–Ω–∏–π">–°–∏–Ω–∏–π</option>
                <option value="–ö—Ä–∞—Å–Ω—ã–π">–ö—Ä–∞—Å–Ω—ã–π</option>
                <option value="–ó–µ–ª—ë–Ω—ã–π">–ó–µ–ª—ë–Ω—ã–π</option>
                <option value="–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π">–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π</option>
                <option value="–ë–µ–∂–µ–≤—ã–π">–ë–µ–∂–µ–≤—ã–π</option>
                <option value="–ñ—ë–ª—Ç—ã–π">–ñ—ë–ª—Ç—ã–π</option>
                <option value="–û—Ä–∞–Ω–∂–µ–≤—ã–π">–û—Ä–∞–Ω–∂–µ–≤—ã–π</option>
                <option value="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π">–§–∏–æ–ª–µ—Ç–æ–≤—ã–π</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              –ú–æ–¥–µ–ª—å<span class="required">*</span>
            </label>
            <div class="form-select-wrapper">
              <select class="form-select" id="carModel" disabled>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Rental car fields -->
        <div id="rentalCarFields" style="display: none;">
          <div class="form-group" style="grid-column: 1 / -1;">
            <label class="form-label">
              –ê–≤—Ç–æ–º–æ–±–∏–ª—å<span class="required">*</span>
            </label>
            <div class="form-select-wrapper">
              <select class="form-select" id="rentalCarSelect">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              –ü—Ä–æ–±–µ–≥<span class="required">*</span>
            </label>
            <input 
              type="text" 
              class="form-input" 
              id="rentalMileage" 
              placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å –∏–∑ —Å–ø–∏—Å–∫–∞"
              readonly
            >
          </div>

          <div id="rentalPriceInfo" class="rental-info" style="display: none; grid-column: 1 / -1;">
            <div style="font-size: var(--g-font-size-sm); color: var(--g-color-text-secondary);">
              –°—Ç–æ–∏–º–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã –≤ —Å—É—Ç–∫–∏:
            </div>
            <div class="rental-price" id="rentalPrice"></div>
          </div>
        </div>
      </div>

      <button type="submit" class="continue-button">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </form>
  </div>

  <div class="footer-actions">
    <button class="support-button" onclick="showSupport()">?</button>
    <a href="../index.html" class="logout-link">–í—ã–π—Ç–∏</a>
  </div>

  <script src="../assets/js/mock-data.js"></script>
  <script src="../assets/js/app.js"></script>
  <script>
    let currentCarType = 'own';

    function toggleCarType(type) {
      currentCarType = type;
      const ownBtn = document.getElementById('ownCarBtn');
      const rentalBtn = document.getElementById('rentalCarBtn');
      const ownFields = document.getElementById('ownCarFields');
      const rentalFields = document.getElementById('rentalCarFields');
      const subtitle = document.getElementById('formSubtitle');

      if (type === 'own') {
        ownBtn.classList.add('active');
        rentalBtn.classList.remove('active');
        ownFields.style.display = 'grid';
        rentalFields.style.display = 'none';
        subtitle.textContent = '–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞';
        
        // Set required attributes for own car fields
        document.getElementById('registrationMark').required = true;
        document.getElementById('productionYear').required = true;
        document.getElementById('carBrand').required = true;
        document.getElementById('carColor').required = true;
        document.getElementById('carModel').required = true;
        
        // Remove required from rental fields
        document.getElementById('rentalCarSelect').required = false;
      } else {
        ownBtn.classList.remove('active');
        rentalBtn.classList.add('active');
        ownFields.style.display = 'none';
        rentalFields.style.display = 'grid';
        subtitle.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è –∞—Ä–µ–Ω–¥—ã';
        
        // Remove required from own car fields
        document.getElementById('registrationMark').required = false;
        document.getElementById('productionYear').required = false;
        document.getElementById('carBrand').required = false;
        document.getElementById('carColor').required = false;
        document.getElementById('carModel').required = false;
        
        // Set required for rental fields
        document.getElementById('rentalCarSelect').required = true;
      }
    }

    // Populate brand selects
    function populateBrandSelects() {
      const brandSelect = document.getElementById('carBrand');
      const rentalCarSelect = document.getElementById('rentalCarSelect');
      
      const uniqueBrands = [...new Set(mockData.cars.map(c => c.brand))].sort();
      
      if (brandSelect) {
        uniqueBrands.forEach(brand => {
          const option = document.createElement('option');
          option.value = brand;
          option.textContent = brand;
          brandSelect.appendChild(option);
        });
      }

      // Populate rental car select with all available cars
      if (rentalCarSelect) {
        mockData.cars.forEach(car => {
          const option = document.createElement('option');
          option.value = car.id;
          option.textContent = `${car.brand} ${car.model} - ${car.plate}`;
          option.dataset.carId = car.id;
          rentalCarSelect.appendChild(option);
        });
      }
    }

    // Update model select when brand changes (own car)
    const brandSelect = document.getElementById('carBrand');
    const modelSelect = document.getElementById('carModel');
    
    brandSelect?.addEventListener('change', (e) => {
      const selectedBrand = e.target.value;
      modelSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å</option>';
      
      if (selectedBrand) {
        modelSelect.disabled = false;
        const uniqueModels = [...new Set(
          mockData.cars
            .filter(c => c.brand === selectedBrand)
            .map(c => c.model)
        )].sort();
        
        uniqueModels.forEach(model => {
          const option = document.createElement('option');
          option.value = model;
          option.textContent = model;
          modelSelect.appendChild(option);
        });
      } else {
        modelSelect.disabled = true;
      }
    });

    // Update car info when rental car is selected
    const rentalCarSelect = document.getElementById('rentalCarSelect');
    const rentalMileageInput = document.getElementById('rentalMileage');
    const rentalPriceInfo = document.getElementById('rentalPriceInfo');
    const rentalPriceEl = document.getElementById('rentalPrice');

    rentalCarSelect?.addEventListener('change', (e) => {
      const selectedCarId = parseInt(e.target.value);
      
      if (selectedCarId) {
        const car = getCarById(selectedCarId);
        
        if (car) {
          rentalMileageInput.value = car.mileage ? formatNumber(car.mileage).replace(/,/g, ' ') + ' –∫–º' : '-';
          
          // Find rent contract for this car
          const contract = mockData.rentContracts.find(c => c.vehiclePlate === car.plate && c.status === '–¥–µ–π—Å—Ç–≤—É—é—â–∏–π');
          const dailyRent = contract ? contract.dailyRent : 2000; // Default or from contract
          
          rentalPriceEl.textContent = formatCurrency(dailyRent) + ' / —Å—É—Ç–∫–∏';
          rentalPriceInfo.style.display = 'block';
        }
      } else {
        rentalMileageInput.value = '';
        rentalPriceInfo.style.display = 'none';
      }
    });

    function handleSubmit(event) {
      event.preventDefault();
      
      if (currentCarType === 'own') {
        const formData = {
          registrationMark: document.getElementById('registrationMark').value,
          brand: document.getElementById('carBrand').value,
          model: document.getElementById('carModel').value,
          productionYear: document.getElementById('productionYear').value,
          color: document.getElementById('carColor').value
        };

        if (!formData.registrationMark || !formData.brand || !formData.model || !formData.productionYear || !formData.color) {
          alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
          return;
        }

        alert(`–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!\n\n–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–Ω–∞–∫: ${formData.registrationMark}\n–ú–∞—Ä–∫–∞: ${formData.brand}\n–ú–æ–¥–µ–ª—å: ${formData.model}\n–ì–æ–¥: ${formData.productionYear}\n–¶–≤–µ—Ç: ${formData.color}`);
      } else {
        const selectedCarId = document.getElementById('rentalCarSelect').value;
        const mileage = document.getElementById('rentalMileage').value;

        if (!selectedCarId) {
          alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å');
          return;
        }

        const car = getCarById(parseInt(selectedCarId));
        const contract = car ? mockData.rentContracts.find(c => c.vehiclePlate === car.plate && c.status === '–¥–µ–π—Å—Ç–≤—É—é—â–∏–π') : null;
        const dailyRent = contract ? contract.dailyRent : 2000;

        alert(`–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!\n\n–ú–∞—Ä–∫–∞: ${car.brand}\n–ú–æ–¥–µ–ª—å: ${car.model}\n–ì–æ—Å–Ω–æ–º–µ—Ä: ${car.plate}\n–ü—Ä–æ–±–µ–≥: ${mileage}\n–°—Ç–æ–∏–º–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã: ${formatCurrency(dailyRent)} / —Å—É—Ç–∫–∏`);
      }
      
      // Navigate to next step (you can change this URL)
      // window.location.href = 'step4.html';
    }

    function showSupport() {
      alert('–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ email –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏.');
    }

    // Initialize
    populateBrandSelects();
  </script>
</body>
</html>
