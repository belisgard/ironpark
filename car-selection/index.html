<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–í—ã–±–æ—Ä –∞–≤—Ç–æ - –®–∞–≥ –≤—ã–±–æ—Ä–∞ –∞–≤—Ç–æ</title>
  <link rel="stylesheet" href="../assets/css/gravity-theme.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <style>
    body {
      background-color: #F5F5F5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      margin: 0;
    }

    .form-card {
      background: white;
      border-radius: 16px;
      padding: 32px;
      max-width: 900px;
      width: 100%;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .car-type-toggle {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      padding: 4px;
      background: var(--g-color-base-generic);
      border-radius: 8px;
      width: fit-content;
    }

    .car-type-button {
      padding: 8px 16px;
      border: none;
      background: transparent;
      border-radius: 6px;
      font-size: var(--g-font-size-md);
      font-weight: 500;
      cursor: pointer;
      color: var(--g-color-text-secondary);
      transition: all 0.2s;
    }

    .car-type-button.active {
      background: white;
      color: var(--g-color-text-primary);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .rental-info {
      background: var(--g-color-base-generic);
      padding: 16px;
      border-radius: 8px;
      margin-top: 16px;
    }

    .rental-price {
      font-size: var(--g-font-size-lg);
      font-weight: 600;
      color: #FF3D00;
      margin-top: 8px;
    }

    .form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--g-color-line-generic);
    }

    .form-header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .back-button {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--g-color-text-primary);
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .back-button:hover {
      background: var(--g-color-base-generic);
      border-radius: 50%;
    }

    .form-title {
      font-size: var(--g-font-size-xl);
      font-weight: 600;
      margin: 0;
      color: var(--g-color-text-primary);
    }

    .progress-section {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .progress-bar {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    .progress-segment {
      width: 40px;
      height: 4px;
      border-radius: 2px;
      background: var(--g-color-line-generic);
    }

    .progress-segment.active {
      background: #FF3D00;
    }

    .progress-text {
      font-size: var(--g-font-size-sm);
      color: var(--g-color-text-secondary);
      white-space: nowrap;
    }

    .form-subtitle {
      font-size: var(--g-font-size-md);
      color: var(--g-color-text-secondary);
      margin-bottom: 32px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin-bottom: 32px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-label {
      font-size: var(--g-font-size-sm);
      color: var(--g-color-text-primary);
      margin-bottom: 8px;
      font-weight: 500;
    }

    .form-label .required {
      color: #FF3D00;
      margin-left: 2px;
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--g-color-line-generic);
      border-radius: 8px;
      font-size: var(--g-font-size-md);
      background: white;
      transition: border-color 0.2s;
    }

    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: #FF3D00;
    }

    .form-input[readonly] {
      background: var(--g-color-base-generic);
      cursor: not-allowed;
      color: var(--g-color-text-secondary);
    }

    .form-input[readonly]:focus {
      border-color: var(--g-color-line-generic);
    }

    .form-select-wrapper {
      position: relative;
    }

    .form-select-wrapper::after {
      content: '‚ñº';
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      color: var(--g-color-text-hint);
      font-size: 12px;
    }

    .date-input-wrapper {
      position: relative;
    }

    .date-input-wrapper::after {
      content: 'üìÖ';
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      font-size: 16px;
    }

    .continue-button {
      width: 100%;
      padding: 16px;
      background: #FF3D00;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: var(--g-font-size-lg);
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .continue-button:hover {
      background: #E63400;
    }

    .continue-button:active {
      background: #CC2E00;
    }

    .continue-button:disabled {
      background: var(--g-color-base-generic);
      color: var(--g-color-text-secondary);
      cursor: not-allowed;
    }

    .footer-actions {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      margin-top: 32px;
    }

    .support-button {
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: background-color 0.2s;
      box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
    }

    .support-button:hover {
      background: #45a049;
    }

    .logout-link {
      color: var(--g-color-text-secondary);
      text-decoration: none;
      font-size: var(--g-font-size-sm);
      cursor: pointer;
      transition: color 0.2s;
    }

    .logout-link:hover {
      color: var(--g-color-text-primary);
    }

    .multi-select-container {
      position: relative;
    }

    .multi-select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--g-color-line-generic);
      border-radius: 8px;
      font-size: var(--g-font-size-md);
      background: white;
      min-height: 120px;
      max-height: 300px;
      overflow-y: auto;
    }

    .multi-select-item {
      padding: 8px 12px;
      border-bottom: 1px solid var(--g-color-line-generic);
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .multi-select-item:hover {
      background: var(--g-color-base-generic);
    }

    .multi-select-item.selected {
      background: var(--g-color-base-selection);
    }

    .multi-select-item:last-child {
      border-bottom: none;
    }

    .car-item-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .car-item-details {
      flex: 1;
    }

    .car-item-name {
      font-weight: 500;
      margin-bottom: 4px;
    }

    .car-item-specs {
      font-size: var(--g-font-size-sm);
      color: var(--g-color-text-secondary);
    }

    .car-item-price {
      font-weight: 600;
      color: #FF3D00;
      margin-left: 16px;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }

      .form-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }

      .progress-section {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body>
  <div class="form-card">
    <div class="form-header">
      <div class="form-header-left">
        <button class="back-button" onclick="window.history.back()">‚Äπ</button>
        <h1 class="form-title" id="pageTitle">–í—ã–±–æ—Ä —Ç–∏–ø–∞ –∞–≤—Ç–æ</h1>
      </div>
      <div class="progress-section">
        <div class="progress-bar">
          <div class="progress-segment" id="progress1"></div>
          <div class="progress-segment" id="progress2"></div>
        </div>
        <span class="progress-text" id="progressText">–®–∞–≥ 1 –∏–∑ 2</span>
      </div>
    </div>

    <!-- Step 1: Car Type Selection -->
    <div id="step1Content">
      <p class="form-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∞–≤—Ç–æ–º–æ–±–∏–ª—è</p>
      
      <div class="car-type-toggle">
        <button type="button" class="car-type-button active" id="ownCarBtn" onclick="selectCarType('own')">
          –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∞–≤—Ç–æ
        </button>
        <button type="button" class="car-type-button" id="rentalCarBtn" onclick="selectCarType('rental')">
          –ê—Ä–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–µ –∞–≤—Ç–æ
        </button>
      </div>

      <button type="button" class="continue-button" id="step1Continue" onclick="goToStep2()" disabled>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>

    <!-- Step 2: STS Data / Rental Selection -->
    <div id="step2Content" style="display: none;">
      <p class="form-subtitle" id="formSubtitle">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞</p>

      <form id="stsForm" onsubmit="handleSubmit(event)">
        <!-- Own car fields -->
        <div id="ownCarFields" style="display: none;">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">
                –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–Ω–∞–∫<span class="required">*</span>
              </label>
              <input 
                type="text" 
                class="form-input" 
                id="registrationMark" 
                placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–Ω–∞–∫"
              >
            </div>

            <div class="form-group">
              <label class="form-label">
                –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è<span class="required">*</span>
              </label>
              <div class="date-input-wrapper">
                <input 
                  type="date" 
                  class="form-input" 
                  id="productionYear" 
                  placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É"
                >
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                –ú–∞—Ä–∫–∞<span class="required">*</span>
              </label>
              <div class="form-select-wrapper">
                <select class="form-select" id="carBrand">
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                –ú–æ–¥–µ–ª—å<span class="required">*</span>
              </label>
              <div class="form-select-wrapper">
                <select class="form-select" id="carModel" disabled>
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                –¶–≤–µ—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª—è<span class="required">*</span>
              </label>
              <div class="form-select-wrapper">
                <select class="form-select" id="carColor">
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç</option>
                  <option value="–ë–µ–ª—ã–π">–ë–µ–ª—ã–π</option>
                  <option value="–ß—ë—Ä–Ω—ã–π">–ß—ë—Ä–Ω—ã–π</option>
                  <option value="–°–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–π">–°–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–π</option>
                  <option value="–°–µ—Ä—ã–π">–°–µ—Ä—ã–π</option>
                  <option value="–°–∏–Ω–∏–π">–°–∏–Ω–∏–π</option>
                  <option value="–ö—Ä–∞—Å–Ω—ã–π">–ö—Ä–∞—Å–Ω—ã–π</option>
                  <option value="–ó–µ–ª—ë–Ω—ã–π">–ó–µ–ª—ë–Ω—ã–π</option>
                  <option value="–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π">–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π</option>
                  <option value="–ë–µ–∂–µ–≤—ã–π">–ë–µ–∂–µ–≤—ã–π</option>
                  <option value="–ñ—ë–ª—Ç—ã–π">–ñ—ë–ª—Ç—ã–π</option>
                  <option value="–û—Ä–∞–Ω–∂–µ–≤—ã–π">–û—Ä–∞–Ω–∂–µ–≤—ã–π</option>
                  <option value="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π">–§–∏–æ–ª–µ—Ç–æ–≤—ã–π</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Rental car fields -->
        <div id="rentalCarFields" style="display: none;">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">
                –¢–∞—Ä–∏—Ñ<span class="required">*</span>
              </label>
              <div class="form-select-wrapper">
                <select class="form-select" id="tariffSelect">
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ</option>
                  <option value="–≠–∫–æ–Ω–æ–º">–≠–∫–æ–Ω–æ–º</option>
                  <option value="–ö–æ–º—Ñ–æ—Ä—Ç">–ö–æ–º—Ñ–æ—Ä—Ç</option>
                  <option value="–£–ª—å—Ç–∏–º–∞">–£–ª—å—Ç–∏–º–∞</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                –í–∏–¥ —Ç–æ–ø–ª–∏–≤–∞<span class="required">*</span>
              </label>
              <div class="form-select-wrapper">
                <select class="form-select" id="fuelTypeSelect">
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ —Ç–æ–ø–ª–∏–≤–∞</option>
                  <option value="–ê–ò-92">–ê–ò-92</option>
                  <option value="–ê–ò-95">–ê–ò-95</option>
                  <option value="–ê–ò-98">–ê–ò-98</option>
                  <option value="–î–∏–∑–µ–ª—å">–î–∏–∑–µ–ª—å</option>
                  <option value="–ì–∞–∑">–ì–∞–∑</option>
                  <option value="–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ">–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                –ú–∞—Ä–∫–∞<span class="required">*</span>
              </label>
              <div class="form-select-wrapper">
                <select class="form-select" id="rentalBrandSelect">
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                –ú–æ–¥–µ–ª—å<span class="required">*</span>
              </label>
              <div class="form-select-wrapper">
                <select class="form-select" id="rentalModelSelect" disabled>
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å</option>
                </select>
              </div>
            </div>

            <div class="form-group full-width">
              <label class="form-label">
                –í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å<span class="required">*</span>
              </label>
              <div class="multi-select-container">
                <div class="multi-select" id="rentalCarMultiSelect">
                  <div style="padding: 16px; text-align: center; color: var(--g-color-text-secondary);">
                    –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ, –≤–∏–¥ —Ç–æ–ø–ª–∏–≤–∞, –º–∞—Ä–∫—É –∏ –º–æ–¥–µ–ª—å
                  </div>
                </div>
              </div>
            </div>

            <div id="selectedCarInfo" class="rental-info" style="display: none; grid-column: 1 / -1;">
              <div style="font-size: var(--g-font-size-sm); color: var(--g-color-text-secondary); margin-bottom: 8px;">
                –í—ã–±—Ä–∞–Ω–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å:
              </div>
              <div id="selectedCarDetails" style="font-weight: 500; margin-bottom: 8px;"></div>
              <div style="font-size: var(--g-font-size-sm); color: var(--g-color-text-secondary);">
                –ü—Ä–æ–±–µ–≥: <span id="selectedCarMileage"></span>
              </div>
              <div class="rental-price" id="selectedCarPrice"></div>
            </div>
          </div>
        </div>

        <div style="display: flex; gap: 12px; margin-top: 16px;">
          <button type="button" class="btn btn--normal" onclick="goToStep1()" style="flex: 1;">–ù–∞–∑–∞–¥</button>
          <button type="submit" class="continue-button" style="flex: 1;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>

  <div class="footer-actions">
    <button class="support-button" onclick="showSupport()">?</button>
    <a href="../index.html" class="logout-link">–í—ã–π—Ç–∏</a>
  </div>

  <script src="../assets/js/mock-data.js"></script>
  <script src="../assets/js/app.js"></script>
  <script>
    let currentStep = 1;
    let selectedCarType = null;
    let selectedRentalCar = null;

    function selectCarType(type) {
      selectedCarType = type;
      const ownBtn = document.getElementById('ownCarBtn');
      const rentalBtn = document.getElementById('rentalCarBtn');
      const continueBtn = document.getElementById('step1Continue');

      if (type === 'own') {
        ownBtn.classList.add('active');
        rentalBtn.classList.remove('active');
      } else {
        ownBtn.classList.remove('active');
        rentalBtn.classList.add('active');
      }
      
      continueBtn.disabled = false;
    }

    function goToStep1() {
      currentStep = 1;
      document.getElementById('step1Content').style.display = 'block';
      document.getElementById('step2Content').style.display = 'none';
      document.getElementById('pageTitle').textContent = '–í—ã–±–æ—Ä —Ç–∏–ø–∞ –∞–≤—Ç–æ';
      document.getElementById('progressText').textContent = '–®–∞–≥ 1 –∏–∑ 2';
      document.getElementById('progress1').classList.add('active');
      document.getElementById('progress2').classList.remove('active');
    }

    function goToStep2() {
      if (!selectedCarType) return;
      
      currentStep = 2;
      document.getElementById('step1Content').style.display = 'none';
      document.getElementById('step2Content').style.display = 'block';
      document.getElementById('pageTitle').textContent = selectedCarType === 'own' ? '–î–∞–Ω–Ω—ã–µ –∏–∑ –°–¢–°' : '–í—ã–±–æ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è';
      document.getElementById('progressText').textContent = '–®–∞–≥ 2 –∏–∑ 2';
      document.getElementById('progress1').classList.add('active');
      document.getElementById('progress2').classList.add('active');

      if (selectedCarType === 'own') {
        document.getElementById('ownCarFields').style.display = 'block';
        document.getElementById('rentalCarFields').style.display = 'none';
        document.getElementById('formSubtitle').textContent = '–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞';
        populateBrandSelects();
      } else {
        document.getElementById('ownCarFields').style.display = 'none';
        document.getElementById('rentalCarFields').style.display = 'block';
        document.getElementById('formSubtitle').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è –∞—Ä–µ–Ω–¥—ã';
        populateRentalBrandSelects();
      }
    }

    // Populate brand selects for own car
    function populateBrandSelects() {
      const brandSelect = document.getElementById('carBrand');
      const uniqueBrands = [...new Set(mockData.cars.map(c => c.brand))].sort();
      
      brandSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É</option>';
      uniqueBrands.forEach(brand => {
        const option = document.createElement('option');
        option.value = brand;
        option.textContent = brand;
        brandSelect.appendChild(option);
      });
    }

    // Populate brand selects for rental car
    function populateRentalBrandSelects() {
      const brandSelect = document.getElementById('rentalBrandSelect');
      const uniqueBrands = [...new Set(mockData.cars.map(c => c.brand))].sort();
      
      brandSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É</option>';
      uniqueBrands.forEach(brand => {
        const option = document.createElement('option');
        option.value = brand;
        option.textContent = brand;
        brandSelect.appendChild(option);
      });
    }

    // Update model select when brand changes (own car)
    document.getElementById('carBrand')?.addEventListener('change', (e) => {
      const selectedBrand = e.target.value;
      const modelSelect = document.getElementById('carModel');
      modelSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å</option>';
      
      if (selectedBrand) {
        modelSelect.disabled = false;
        const uniqueModels = [...new Set(
          mockData.cars
            .filter(c => c.brand === selectedBrand)
            .map(c => c.model)
        )].sort();
        
        uniqueModels.forEach(model => {
          const option = document.createElement('option');
          option.value = model;
          option.textContent = model;
          modelSelect.appendChild(option);
        });
      } else {
        modelSelect.disabled = true;
      }
    });

    // Update model select when brand changes (rental car)
    document.getElementById('rentalBrandSelect')?.addEventListener('change', (e) => {
      const selectedBrand = e.target.value;
      const modelSelect = document.getElementById('rentalModelSelect');
      modelSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å</option>';
      
      if (selectedBrand) {
        modelSelect.disabled = false;
        const uniqueModels = [...new Set(
          mockData.cars
            .filter(c => c.brand === selectedBrand)
            .map(c => c.model)
        )].sort();
        
        uniqueModels.forEach(model => {
          const option = document.createElement('option');
          option.value = model;
          option.textContent = model;
          modelSelect.appendChild(option);
        });
      } else {
        modelSelect.disabled = true;
      }
      
      updateRentalCarList();
    });

    // Update rental car list when filters change
    function updateRentalCarList() {
      const tariff = document.getElementById('tariffSelect').value;
      const fuelType = document.getElementById('fuelTypeSelect').value;
      const brand = document.getElementById('rentalBrandSelect').value;
      const model = document.getElementById('rentalModelSelect').value;
      const multiSelect = document.getElementById('rentalCarMultiSelect');
      
      if (!tariff || !fuelType || !brand || !model) {
        multiSelect.innerHTML = '<div style="padding: 16px; text-align: center; color: var(--g-color-text-secondary);">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ, –≤–∏–¥ —Ç–æ–ø–ª–∏–≤–∞, –º–∞—Ä–∫—É –∏ –º–æ–¥–µ–ª—å</div>';
        selectedRentalCar = null;
        document.getElementById('selectedCarInfo').style.display = 'none';
        return;
      }

      // Filter cars by criteria
      const filteredCars = mockData.cars.filter(car => {
        return car.brand === brand && 
               car.model === model && 
               car.category === tariff &&
               (car.fuelType || '–ê–ò-95') === fuelType;
      });

      if (filteredCars.length === 0) {
        multiSelect.innerHTML = '<div style="padding: 16px; text-align: center; color: var(--g-color-text-secondary);">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏</div>';
        selectedRentalCar = null;
        document.getElementById('selectedCarInfo').style.display = 'none';
        return;
      }

      multiSelect.innerHTML = filteredCars.map(car => {
        const contract = mockData.rentContracts.find(c => c.vehiclePlate === car.plate && c.status === '–¥–µ–π—Å—Ç–≤—É—é—â–∏–π');
        const dailyRent = contract ? contract.dailyRent : (tariff === '–≠–∫–æ–Ω–æ–º' ? 2000 : tariff === '–ö–æ–º—Ñ–æ—Ä—Ç' ? 3500 : 5000);
        const isSelected = selectedRentalCar && selectedRentalCar.id === car.id;
        
        return `
          <div class="multi-select-item ${isSelected ? 'selected' : ''}" onclick="selectRentalCar(${car.id})">
            <div class="car-item-info">
              <div class="car-item-details">
                <div class="car-item-name">${car.brand} ${car.model} - ${car.plate}</div>
                <div class="car-item-specs">–ü—Ä–æ–±–µ–≥: ${formatNumber(car.mileage || 0).replace(/,/g, ' ')} –∫–º</div>
              </div>
              <div class="car-item-price">${formatCurrency(dailyRent)} / —Å—É—Ç–∫–∏</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function selectRentalCar(carId) {
      const car = getCarById(carId);
      if (!car) return;

      selectedRentalCar = car;
      const contract = mockData.rentContracts.find(c => c.vehiclePlate === car.plate && c.status === '–¥–µ–π—Å—Ç–≤—É—é—â–∏–π');
      const tariff = document.getElementById('tariffSelect').value;
      const dailyRent = contract ? contract.dailyRent : (tariff === '–≠–∫–æ–Ω–æ–º' ? 2000 : tariff === '–ö–æ–º—Ñ–æ—Ä—Ç' ? 3500 : 5000);

      document.getElementById('selectedCarDetails').textContent = `${car.brand} ${car.model} - ${car.plate}`;
      document.getElementById('selectedCarMileage').textContent = formatNumber(car.mileage || 0).replace(/,/g, ' ') + ' –∫–º';
      document.getElementById('selectedCarPrice').textContent = formatCurrency(dailyRent) + ' / —Å—É—Ç–∫–∏';
      document.getElementById('selectedCarInfo').style.display = 'block';

      // Update visual selection
      updateRentalCarList();
    }

    // Add event listeners for rental car filters
    document.getElementById('tariffSelect')?.addEventListener('change', updateRentalCarList);
    document.getElementById('fuelTypeSelect')?.addEventListener('change', updateRentalCarList);
    document.getElementById('rentalModelSelect')?.addEventListener('change', updateRentalCarList);

    function handleSubmit(event) {
      event.preventDefault();
      
      if (selectedCarType === 'own') {
        const formData = {
          registrationMark: document.getElementById('registrationMark').value,
          brand: document.getElementById('carBrand').value,
          model: document.getElementById('carModel').value,
          productionYear: document.getElementById('productionYear').value,
          color: document.getElementById('carColor').value
        };

        if (!formData.registrationMark || !formData.brand || !formData.model || !formData.productionYear || !formData.color) {
          alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
          return;
        }

        alert(`–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!\n\n–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–Ω–∞–∫: ${formData.registrationMark}\n–ú–∞—Ä–∫–∞: ${formData.brand}\n–ú–æ–¥–µ–ª—å: ${formData.model}\n–ì–æ–¥: ${formData.productionYear}\n–¶–≤–µ—Ç: ${formData.color}`);
      } else {
        if (!selectedRentalCar) {
          alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å');
          return;
        }

        const tariff = document.getElementById('tariffSelect').value;
        const contract = mockData.rentContracts.find(c => c.vehiclePlate === selectedRentalCar.plate && c.status === '–¥–µ–π—Å—Ç–≤—É—é—â–∏–π');
        const dailyRent = contract ? contract.dailyRent : (tariff === '–≠–∫–æ–Ω–æ–º' ? 2000 : tariff === '–ö–æ–º—Ñ–æ—Ä—Ç' ? 3500 : 5000);

        alert(`–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!\n\n–ú–∞—Ä–∫–∞: ${selectedRentalCar.brand}\n–ú–æ–¥–µ–ª—å: ${selectedRentalCar.model}\n–ì–æ—Å–Ω–æ–º–µ—Ä: ${selectedRentalCar.plate}\n–ü—Ä–æ–±–µ–≥: ${formatNumber(selectedRentalCar.mileage || 0).replace(/,/g, ' ')} –∫–º\n–°—Ç–æ–∏–º–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã: ${formatCurrency(dailyRent)} / —Å—É—Ç–∫–∏`);
      }
    }

    function showSupport() {
      alert('–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ email –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏.');
    }

    // Initialize progress
    document.getElementById('progress1').classList.add('active');
  </script>
</body>
</html>
